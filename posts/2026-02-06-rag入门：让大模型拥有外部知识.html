<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG入门：让大模型拥有外部知识 - TechBlog</title>
    <meta name="description" content="详解检索增强生成(RAG)技术原理、系统架构和完整实现，通过企业知识库问答案例，学习如何让大语言模型访问和利用外部知识。">
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <span class="logo-icon">&lt;/&gt;</span>
                <span class="logo-text">TechBlog</span>
            </a>
            <ul class="nav-menu">
                <li><a href="../index.html" class="nav-link">首页</a></li>
                <li><a href="../posts.html" class="nav-link">文章</a></li>
                <li><a href="../about.html" class="nav-link">关于</a></li>
                <li><a href="../contact.html" class="nav-link">联系</a></li>
            </ul>
            <div class="nav-actions">
                <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
                <button class="mobile-menu-toggle" id="mobileMenuToggle"><i class="fas fa-bars"></i></button>
            </div>
        </div>
    </nav>

    <article>
        <header class="article-header">
            <div class="container">
                <div class="article-meta">
                    <div class="post-tags"><span class="tag">RAG</span><span class="tag">LLM</span><span class="tag">向量数据库</span><span class="tag">LangChain</span></div>
                    <span class="read-time"><i class="far fa-clock"></i> 20 分钟阅读</span>
                </div>
                <h1 class="article-title">RAG入门：让大模型拥有外部知识</h1>
                <div class="post-meta" style="justify-content: flex-start; gap: 2rem;">
                    <div class="author">
                        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" alt="作者" class="author-avatar">
                        <div>
                            <span class="author-name">小欧Jacory</span><br>
                            <span style="font-size: 0.875rem; color: var(--text-muted);">前端开发工程师</span>
                        </div>
                    </div>
                    <span class="post-date">2026/2/6</span>
                </div>
            </div>
        </header>



        <div class="article-content">
            <h2>目录</h2>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFrag">什么是RAG</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81rag">为什么需要RAG</a></li>
<li><a href="#rag%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">RAG工作原理</a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">系统架构设计</a></li>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">环境准备</a></li>
<li><a href="#%E5%AE%9E%E6%93%8D%E6%A1%88%E4%BE%8B%E4%BC%81%E4%B8%9A%E7%9F%A5%E8%AF%86%E5%BA%93%E9%97%AE%E7%AD%94">实操案例：企业知识库问答</a></li>
<li><a href="#%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7">优化技巧</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
<h2>什么是RAG</h2>
<p><strong>RAG（Retrieval-Augmented Generation，检索增强生成）</strong> 是一种将外部知识检索与大语言模型生成能力相结合的技术架构。</p>
<p>传统的大语言模型（如GPT-4、Claude等）虽然具备强大的语言理解和生成能力，但存在两个核心局限：</p>
<ol>
<li><strong>知识截止日期</strong>：模型的训练数据有明确的时间 cutoff，无法获取最新信息</li>
<li><strong>幻觉问题</strong>：模型可能会生成听起来合理但实际错误的内容</li>
</ol>
<p>RAG 通过引入外部知识库，让模型在回答问题前先检索相关文档，基于检索到的准确信息来生成回答，从而解决上述问题。</p>
<h3>RAG 的核心价值</h3>
<table>
<thead>
<tr>
<th>能力</th>
<th>传统LLM</th>
<th>RAG增强</th>
</tr>
</thead>
<tbody><tr>
<td>最新知识</td>
<td>❌ 受限于训练数据</td>
<td>✅ 可实时更新知识库</td>
</tr>
<tr>
<td>准确性</td>
<td>⚠️ 可能产生幻觉</td>
<td>✅ 基于检索事实生成</td>
</tr>
<tr>
<td>可溯源</td>
<td>❌ 无法知道来源</td>
<td>✅ 可展示参考文档</td>
</tr>
<tr>
<td>私有化</td>
<td>❌ 需要训练</td>
<td>✅ 直接挂载私有文档</td>
</tr>
</tbody></table>
<h2>为什么需要RAG</h2>
<h3>场景1：企业知识库问答</h3>
<p>想象一个客服场景：用户询问&quot;公司2024年的退货政策是什么？&quot;</p>
<ul>
<li><strong>传统LLM</strong>：可能基于过时的训练数据回答，或者编造政策</li>
<li><strong>RAG方案</strong>：从企业最新的政策文档中检索准确信息，给出权威回答</li>
</ul>
<h3>场景2：医学文献查询</h3>
<p>医生询问某种罕见病的最新治疗方案。</p>
<ul>
<li><strong>传统LLM</strong>：训练数据可能不包含最新医学研究</li>
<li><strong>RAG方案</strong>：从PubMed等最新论文库检索相关研究</li>
</ul>
<h3>场景3：法律法规咨询</h3>
<p>查询最新的税法变更。</p>
<ul>
<li><strong>传统LLM</strong>：无法获知最新法律修订</li>
<li><strong>RAG方案</strong>：连接官方法律数据库，提供准确条文</li>
</ul>
<h2>RAG工作原理</h2>
<p>RAG 系统的工作流程可以分为三个主要阶段：</p>
<h3>阶段1：文档预处理（离线）</h3>
<pre><code>原始文档 → 文本提取 → 文本分块 → 向量化 → 存储到向量数据库
</code></pre>
<ol>
<li><strong>文本提取</strong>：从PDF、Word、网页等格式提取纯文本</li>
<li><strong>文本分块</strong>：将长文档切分成适当大小的段落（通常500-1000字符）</li>
<li><strong>向量化</strong>：使用Embedding模型将文本转换为向量</li>
<li><strong>存储</strong>：将向量存入向量数据库（如Chroma、Pinecone、Milvus）</li>
</ol>
<h3>阶段2：检索（在线）</h3>
<pre><code>用户问题 → 向量化 → 相似度搜索 → 返回Top-K相关文档
</code></pre>
<ol>
<li>将用户问题转换为向量</li>
<li>在向量数据库中进行相似度搜索</li>
<li>返回最相关的K个文档片段</li>
</ol>
<h3>阶段3：生成（在线）</h3>
<pre><code>用户问题 + 检索到的文档 → 构建Prompt → LLM生成回答
</code></pre>
<p>将检索到的上下文与用户问题一起送入大模型，生成基于事实的回答。</p>
<h2>系统架构设计</h2>
<pre><code>┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   用户提问      │────▶│   问题向量化    │────▶│  向量相似度搜索  │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
                              ┌──────────────────────────┘
                              ▼
                    ┌─────────────────┐
                    │   向量数据库     │
                    │  (ChromaDB等)   │
                    └────────┬────────┘
                             │
                             ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   展示回答      │◀────│   LLM生成回答   │◀────│  构建Prompt     │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                               ▲
                               │
                    ┌──────────┴──────────┐
                    │   检索到的上下文     │
                    └─────────────────────┘
</code></pre>
<h2>环境准备</h2>
<h3>安装依赖</h3>
<pre><code class="language-bash">pip install langchain langchain-openai chromadb python-dotenv
</code></pre>
<h3>配置API密钥</h3>
<p>创建 <code>.env</code> 文件：</p>
<pre><code class="language-bash">OPENAI_API_KEY=your_openai_api_key_here
</code></pre>
<h3>准备测试文档</h3>
<p>创建一个 <code>docs/company_policy.txt</code>：</p>
<pre><code>公司退货政策（2024年更新）：

1. 无理由退货：自购买之日起7天内可申请无理由退货
2. 质量问题退货：发现质量问题可在30天内申请退货
3. 退货流程：
   - 登录官网提交退货申请
   - 客服审核通过后寄回商品
   - 仓库验收后3个工作日内退款
4. 特殊商品：定制类商品不支持退货
</code></pre>
<h2>实操案例：企业知识库问答</h2>
<h3>完整代码实现</h3>
<pre><code class="language-python">import os
from dotenv import load_dotenv
from langchain_openai import OpenAIEmbeddings, ChatOpenAI
from langchain.vectorstores import Chroma
from langchain.text_splitter import CharacterTextSplitter
from langchain.chains import RetrievalQA

# 加载环境变量
load_dotenv()

# 1. 准备文档
def load_documents():
    &quot;&quot;&quot;加载文档并分割成块&quot;&quot;&quot;
    # 读取文档
    with open(&#39;docs/company_policy.txt&#39;, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
        text = f.read()
    
    # 文本分割
    text_splitter = CharacterTextSplitter(
        separator=&quot;\n&quot;,
        chunk_size=200,
        chunk_overlap=50,
        length_function=len
    )
    
    chunks = text_splitter.split_text(text)
    return chunks

# 2. 创建向量数据库
def create_vector_store(chunks):
    &quot;&quot;&quot;创建向量数据库&quot;&quot;&quot;
    # 使用OpenAI的Embedding模型
    embeddings = OpenAIEmbeddings()
    
    # 创建Chroma向量数据库
    vector_store = Chroma.from_texts(
        texts=chunks,
        embedding=embeddings,
        persist_directory=&quot;./chroma_db&quot;
    )
    
    # 持久化存储
    vector_store.persist()
    return vector_store

# 3. 构建RAG问答链
def create_qa_chain(vector_store):
    &quot;&quot;&quot;创建问答链&quot;&quot;&quot;
    # 初始化LLM
    llm = ChatOpenAI(
        model_name=&quot;gpt-3.5-turbo&quot;,
        temperature=0
    )
    
    # 创建检索器
    retriever = vector_store.as_retriever(
        search_kwargs={&quot;k&quot;: 2}  # 返回最相关的2个文档
    )
    
    # 构建RAG链
    qa_chain = RetrievalQA.from_chain_type(
        llm=llm,
        chain_type=&quot;stuff&quot;,
        retriever=retriever,
        return_source_documents=True  # 返回参考文档
    )
    
    return qa_chain

# 4. 主程序
def main():
    print(&quot;🚀 正在初始化RAG系统...&quot;)
    
    # 加载文档
    chunks = load_documents()
    print(f&quot;✅ 文档已分割为 {len(chunks)} 个片段&quot;)
    
    # 创建向量数据库
    vector_store = create_vector_store(chunks)
    print(&quot;✅ 向量数据库创建完成&quot;)
    
    # 创建问答链
    qa_chain = create_qa_chain(vector_store)
    print(&quot;✅ RAG问答链已就绪\n&quot;)
    
    # 交互式问答
    while True:
        question = input(&quot;\n📝 请输入问题 (输入&#39;quit&#39;退出): &quot;)
        
        if question.lower() == &#39;quit&#39;:
            break
        
        # 执行问答
        result = qa_chain.invoke({&quot;query&quot;: question})
        
        print(&quot;\n&quot; + &quot;=&quot;*50)
        print(f&quot;🤖 回答:\n{result[&#39;result&#39;]}&quot;)
        print(&quot;=&quot;*50)
        
        # 显示参考来源
        if result.get(&#39;source_documents&#39;):
            print(&quot;\n📚 参考来源:&quot;)
            for i, doc in enumerate(result[&#39;source_documents&#39;], 1):
                print(f&quot;  [{i}] {doc.page_content[:100]}...&quot;)

if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<h3>运行测试</h3>
<pre><code class="language-bash">python rag_demo.py
</code></pre>
<p>示例交互：</p>
<pre><code>🚀 正在初始化RAG系统...
✅ 文档已分割为 3 个片段
✅ 向量数据库创建完成
✅ RAG问答链已就绪

📝 请输入问题 (输入&#39;quit&#39;退出): 退货期限是多久？

==================================================
🤖 回答:
根据公司退货政策，退货期限分为两种情况：
1. 无理由退货：自购买之日起7天内可申请
2. 质量问题退货：可在30天内申请退货
==================================================

📚 参考来源:
  [1] 公司退货政策（2024年更新）：1. 无理由退货：自购买之日起7天内可申请无理由退货...
  [2] 2. 质量问题退货：发现质量问题可在30天内申请退货...
</code></pre>
<h2>优化技巧</h2>
<h3>1. 文本分块策略</h3>
<pre><code class="language-python">from langchain.text_splitter import RecursiveCharacterTextSplitter

# 递归分块，更智能
splitter = RecursiveCharacterTextSplitter(
    chunk_size=500,
    chunk_overlap=100,
    separators=[&quot;\n\n&quot;, &quot;\n&quot;, &quot;。&quot;, &quot; &quot;, &quot;&quot;]
)
</code></pre>
<h3>2. 混合检索</h3>
<p>结合关键词检索和向量检索：</p>
<pre><code class="language-python">from langchain.retrievers import BM25Retriever, EnsembleRetriever

# BM25关键词检索
bm25_retriever = BM25Retriever.from_documents(documents)
bm25_retriever.k = 2

# 向量检索
vector_retriever = vector_store.as_retriever(search_kwargs={&quot;k&quot;: 2})

# 混合检索（权重可调整）
ensemble_retriever = EnsembleRetriever(
    retrievers=[bm25_retriever, vector_retriever],
    weights=[0.5, 0.5]
)
</code></pre>
<h3>3. 重排序优化</h3>
<pre><code class="language-python">from langchain.retrievers import ContextualCompressionRetriever
from langchain.retrievers.document_compressors import LLMChainExtractor

# 使用LLM对检索结果重新排序
compressor = LLMChainExtractor.from_llm(llm)
compression_retriever = ContextualCompressionRetriever(
    base_compressor=compressor,
    base_retriever=retriever
)
</code></pre>
<h3>4. 提示词工程</h3>
<pre><code class="language-python">from langchain.prompts import PromptTemplate

custom_prompt = &quot;&quot;&quot;基于以下上下文回答问题。如果上下文中没有相关信息，请明确说明。

上下文：
{context}

问题：{question}

请提供详细且准确的回答：&quot;&quot;&quot;

PROMPT = PromptTemplate(
    template=custom_prompt,
    input_variables=[&quot;context&quot;, &quot;question&quot;]
)

qa_chain = RetrievalQA.from_chain_type(
    llm=llm,
    chain_type=&quot;stuff&quot;,
    retriever=retriever,
    chain_type_kwargs={&quot;prompt&quot;: PROMPT}
)
</code></pre>
<h2>总结</h2>
<p>本篇文章详细介绍了 <strong>RAG（检索增强生成）</strong> 技术的核心概念、工作原理和实践方法。</p>
<h3>重点回顾</h3>
<table>
<thead>
<tr>
<th>要点</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>什么是RAG</strong></td>
<td>将外部知识检索与LLM生成相结合的技术架构</td>
</tr>
<tr>
<td><strong>为什么需要</strong></td>
<td>解决LLM知识截止和幻觉问题</td>
</tr>
<tr>
<td><strong>工作原理</strong></td>
<td>文档预处理 → 向量化存储 → 相似度检索 → 上下文生成</td>
</tr>
<tr>
<td><strong>核心组件</strong></td>
<td>Embedding模型、向量数据库、LLM、检索器</td>
</tr>
</tbody></table>
<h3>进阶方向</h3>
<ol>
<li><strong>多模态RAG</strong>：支持图片、PDF、表格等多种文档类型</li>
<li><strong>Agentic RAG</strong>：让RAG具备自主决策能力，可多次检索</li>
<li><strong>Graph RAG</strong>：结合知识图谱进行更复杂的推理</li>
<li><strong>本地部署</strong>：使用Ollama等工具实现完全私有化</li>
</ol>
<hr>
<p><em>本文由AI自动生成，每日更新AI技术教程。如有疑问欢迎留言交流！</em></p>

        </div>
    </article>

    <section style="background: var(--bg-secondary); padding: 3rem 0;">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <h3>喜欢这篇文章？</h3>
                    <p style="color: var(--text-secondary);">分享给更多开发者</p>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-secondary"><i class="fab fa-twitter"></i><span>Twitter</span></button>
                    <button class="btn btn-secondary"><i class="fab fa-weixin"></i><span>微信</span></button>
                </div>
            </div>
        </div>
    </section>

    <section class="featured-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">相关文章</h2>
            </div>
            <div class="featured-grid" style="grid-template-columns: repeat(2, 1fr);">

                <article class="post-card">
                    <div class="post-content">
                        <div class="post-tags">
                            <span class="tag tag-ai">AI</span>
                        </div>
                        <h3 class="post-title">
                            <a href="./2026-02-05-ai-agents-tutorial.html">AI智能体入门：从概念到实践</a>
                        </h3>
                        <p class="post-excerpt">深入理解AI智能体的核心概念、工作原理和架构设计，通过完整的天气查询助手案例，学习如何使用Python构建你的第一个AI智能体。</p>
                    </div>
                </article>
                <article class="post-card">
                    <div class="post-content">
                        <div class="post-tags">
                            <span class="tag tag-ai">AI</span>
                        </div>
                        <h3 class="post-title">
                            <a href="./2026-02-02-openclaw-introduction.html">OpenClaw：你的个人 AI 助手框架</a>
                        </h3>
                        <p class="post-excerpt">OpenClaw 是一个强大的个人 AI 助手框架，让你拥有真正属于自己的智能助手。</p>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="../index.html" class="footer-logo">
                        <span class="logo-icon">&lt;/&gt;</span>
                        <span class="logo-text">TechBlog</span>
                    </a>
                    <p class="footer-description">记录技术成长的每一步，分享编程的乐趣与思考。</p>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-github"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-linkedin"></i></a>
                        <a href="#" class="social-link"><i class="fas fa-rss"></i></a>
                    </div>
                </div>
                <div class="footer-links">
                    <h4>快速链接</h4>
                    <ul>
                        <li><a href="../index.html">首页</a></li>
                        <li><a href="../posts.html">文章</a></li>
                        <li><a href="../about.html">关于</a></li>
                        <li><a href="../contact.html">联系</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>技术标签</h4>
                    <ul>
                        <li><a href="#">React</a></li>
                        <li><a href="#">TypeScript</a></li>
                        <li><a href="#">Node.js</a></li>
                        <li><a href="#">云原生</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 TechBlog. All rights reserved.</p>
                <p>Made with <i class="fas fa-heart"></i> and lots of <i class="fas fa-coffee"></i></p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>